"use strict";(self.webpackChunkseemati_ladies_wear=self.webpackChunkseemati_ladies_wear||[]).push([[399],{399:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var n=s(5043),r=s(8163),i=s(9379),o=s(579);const l="https://seemati-backend.onrender.com",d="/admin-api/products";function a(){const[e,t]=(0,n.useState)(null),[s,a]=(0,n.useState)(!0),[c,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=!1;async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=await fetch(e,(0,i.A)({method:"GET",credentials:"include"},t)),n=s.headers.get("content-type")||"",r=await s.text();if(n.includes("application/json"))try{return{status:s.status,json:JSON.parse(r),rawText:r}}catch(d){throw new Error("Invalid JSON from "+e+" \u2014 parse error")}const o=(r||"").trim(),l=o.startsWith("<")||o.toLowerCase().startsWith("<!doctype");return{status:s.status,json:null,rawText:r,looksLikeHtml:l}}return async function(){a(!0),p(null);try{console.debug("[AdminProductList] trying relative path:",d);const n=await s(d);if(n.json){console.debug("[AdminProductList] got JSON from relative path",n);const s=n.json.products||n.json.data||n.json.items||n.json||[];return void(e||(t(Array.isArray(s)?s:[]),a(!1)))}if(n.looksLikeHtml){console.warn("[AdminProductList] relative path returned HTML (frontend served index), falling back to backend origin");const n=l+d;console.debug("[AdminProductList] trying backend URL:",n);const r=await s(n);if(r.json){console.debug("[AdminProductList] got JSON from backend origin",r);const s=r.json.products||r.json.data||r.json.items||r.json||[];return void(e||(t(Array.isArray(s)?s:[]),a(!1)))}throw new Error("Backend origin did not return JSON. Check backend logs.")}throw console.error("[AdminProductList] unexpected response at relative path:",n),new Error("Unexpected response from relative path")}catch(n){console.error("[AdminProductList] load error:",n),e||(p(n.message||"Unknown error"),t([]),a(!1))}}(),()=>{e=!0}},[]);const u=e=>void 0===e||null===e?"":e;return(0,o.jsxs)("div",{style:{padding:20},children:[(0,o.jsx)("h1",{children:"Products"}),(0,o.jsx)("div",{style:{marginBottom:8},children:(0,o.jsx)(r.N_,{to:"/admin/products/add",children:(0,o.jsx)("button",{children:"Add product"})})}),s&&(0,o.jsx)("div",{children:"Loading products\u2026"}),c&&(0,o.jsxs)("div",{style:{color:"crimson"},children:["Error loading products: ",c]}),!s&&(!e||0===e.length)&&(0,o.jsx)("div",{children:"No products found."}),!s&&e&&e.length>0&&(0,o.jsx)("div",{style:{overflowX:"auto"},children:(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{textAlign:"left",padding:"12px 8px",borderBottom:"1px solid #ddd",width:90},children:"Thumbnail"}),(0,o.jsx)("th",{style:{textAlign:"left",padding:"12px 8px",borderBottom:"1px solid #ddd"},children:"Title"}),(0,o.jsx)("th",{style:{textAlign:"left",padding:"12px 8px",borderBottom:"1px solid #ddd"},children:"Price"}),(0,o.jsx)("th",{style:{textAlign:"left",padding:"12px 8px",borderBottom:"1px solid #ddd"},children:"Stock"}),(0,o.jsx)("th",{style:{textAlign:"left",padding:"12px 8px",borderBottom:"1px solid #ddd"},children:"Category"}),(0,o.jsx)("th",{style:{textAlign:"left",padding:"12px 8px",borderBottom:"1px solid #ddd"},children:"Actions"})]})}),(0,o.jsx)("tbody",{children:e.map((e,t)=>{const s=e._id||e.id||"".concat(t),n=(e=>e&&"string"===typeof e.thumbnail&&e.thumbnail.trim()?e.thumbnail.trim():e&&Array.isArray(e.images)&&e.images.length>0&&e.images[0].url?e.images[0].url:null)(e);return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:{padding:"8px 8px",borderBottom:"1px solid #f0f0f0",verticalAlign:"middle"},children:n?(0,o.jsx)("img",{src:n,alt:u(e.title)||"Product thumbnail",style:{width:64,height:64,objectFit:"cover",borderRadius:4,border:"1px solid #eee"},loading:"lazy"}):(0,o.jsx)("span",{style:{fontSize:12,color:"#999"},children:"No image"})}),(0,o.jsx)("td",{style:{padding:"10px 8px",borderBottom:"1px solid #f0f0f0"},children:u(e.title)}),(0,o.jsx)("td",{style:{padding:"10px 8px",borderBottom:"1px solid #f0f0f0"},children:u(e.price)}),(0,o.jsx)("td",{style:{padding:"10px 8px",borderBottom:"1px solid #f0f0f0"},children:u(e.stock)}),(0,o.jsx)("td",{style:{padding:"10px 8px",borderBottom:"1px solid #f0f0f0"},children:u(e.category)}),(0,o.jsxs)("td",{style:{padding:"10px 8px",borderBottom:"1px solid #f0f0f0"},children:[(0,o.jsx)(r.N_,{to:"/admin/products/".concat(s,"/edit"),children:(0,o.jsx)("button",{children:"Edit"})})," ",(0,o.jsx)("a",{href:n||e.images&&e.images[0]&&e.images[0].url||"#",target:"_blank",rel:"noreferrer",children:(0,o.jsx)("button",{children:"View"})})]})]},s)})})]})})]})}var c=s(5026);function p(){const{id:e}=(0,r.g)(),t=(0,r.Zp)(),s=(0,n.useRef)(null),[l,d]=(0,n.useState)(!0),[a,p]=(0,n.useState)(!1),[u,h]=(0,n.useState)({title:"",slug:"",price:"",mrp:"",stock:"",sku:"",brand:"",category:"",videoUrl:"",colors:"",sizes:"",description:"",isPublished:!1}),[x,m]=(0,n.useState)([]),[j,g]=(0,n.useState)({}),[f,y]=(0,n.useState)([]);function v(e){const{name:t,value:s,type:n,checked:r}=e.target;h("isPublished"===t?e=>(0,i.A)((0,i.A)({},e),{},{isPublished:!!r}):e=>(0,i.A)((0,i.A)({},e),{},{[t]:s}))}return(0,n.useEffect)(()=>(async function(){try{d(!0);const t=await c.A.get("/api/products/".concat(e));if(t.data&&t.data.product){const e=t.data.product;h({title:e.title||"",slug:e.slug||"",price:e.price||"",mrp:e.mrp||"",stock:e.stock||"",sku:e.sku||"",brand:e.brand||"",category:e.category||"",videoUrl:e.videoUrl||"",colors:Array.isArray(e.colors)?e.colors.join(", "):e.colors||"",sizes:Array.isArray(e.sizes)?e.sizes.join(", "):e.sizes||"",description:e.description||"",isPublished:!!e.isPublished});const s=Array.isArray(e.images)?e.images.map(e=>"string"===typeof e?e:e.url||e):[];m(s);const n={};s.forEach(e=>n[e]=!0),g(n)}else alert("Failed to load product.")}catch(t){console.error("Failed to fetch product",t),alert("Error loading product. See console.")}finally{d(!1)}}(),()=>{f.forEach(e=>e.previewUrl&&URL.revokeObjectURL(e.previewUrl))}),[e]),l?(0,o.jsx)("div",{children:"Loading..."}):(0,o.jsxs)("div",{style:{display:"flex",gap:40},children:[(0,o.jsxs)("form",{onSubmit:async function(t){t.preventDefault(),p(!0);try{let t=[];if(f.length&&(t=await async function(){if(!f.length)return[];const t=new FormData;f.forEach(e=>t.append("files",e.file));try{const s=await c.A.put("/api/products/".concat(e,"/upload"),t,{headers:{"Content-Type":"multipart/form-data"}}),n=s&&s.data?s.data:{};let r=[];return Array.isArray(n.uploaded)&&n.uploaded.length?r=n.uploaded:n.key&&n.url?r=[{key:n.key,url:n.url}]:Array.isArray(n)&&(r=n),r.map(e=>e&&e.url?e.url:"string"===typeof e?e:null).filter(Boolean)}catch(s){throw console.error("Upload failed",s),new Error("Upload request failed")}}(),!t.length))return alert("Upload failed or returned no URLs. Check the upload endpoint response."),void p(!1);const s=function(e){const t=[...x.filter(e=>j[e])];return e.forEach(e=>{t.includes(e)||t.push(e)}),t}(t),n={title:u.title,slug:u.slug,price:Number(u.price)||0,mrp:Number(u.mrp)||0,stock:Number(u.stock)||0,sku:u.sku,brand:u.brand,category:u.category,videoUrl:u.videoUrl,description:u.description,isPublished:!!u.isPublished,colors:u.colors?u.colors.split(",").map(e=>e.trim()).filter(Boolean):[],sizes:u.sizes?u.sizes.split(",").map(e=>e.trim()).filter(Boolean):[],images:s},r=await c.A.put("/api/products/".concat(e),n);if(r&&r.data&&r.data.success){f.forEach(e=>e.previewUrl&&URL.revokeObjectURL(e.previewUrl)),y([]);const e=r.data.product||r.data;if(e){const t=Array.isArray(e.images)?e.images.map(e=>"string"===typeof e?e:e.url||e):[];m(t);const s={};t.forEach(e=>s[e]=!0),g(s)}alert("Product updated")}else console.error("Save failed",r),alert("Save failed. Check server response.")}catch(s){console.error("Save error",s),alert(s.message||"Save failed")}finally{p(!1)}},style:{width:"40%"},children:[(0,o.jsx)("button",{type:"button",onClick:()=>t("/admin/products"),children:"Back to products"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Title"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"title",value:u.title,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Slug"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"slug",value:u.slug,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Price"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"price",value:u.price,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"MRP"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"mrp",value:u.mrp,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Stock"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"stock",value:u.stock,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"SKU"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"sku",value:u.sku,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Brand"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"brand",value:u.brand,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Category"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"category",value:u.category,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Video URL"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"videoUrl",value:u.videoUrl,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Colors (comma-separated)"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"colors",value:u.colors,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Sizes (comma-separated)"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{name:"sizes",value:u.sizes,onChange:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{children:"Description"}),(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{name:"description",value:u.description,onChange:v,rows:6})]}),(0,o.jsx)("div",{children:(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{name:"isPublished",type:"checkbox",checked:u.isPublished,onChange:v})," Published"]})}),(0,o.jsxs)("div",{style:{marginTop:8},children:[(0,o.jsx)("button",{type:"submit",disabled:a,children:a?"Saving...":"Save"}),(0,o.jsx)("button",{type:"button",onClick:()=>t("/admin/products"),children:"Cancel"})]})]}),(0,o.jsxs)("div",{style:{width:"40%"},children:[(0,o.jsx)("h3",{children:"Existing Images"}),(0,o.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[x.map((e,t)=>(0,o.jsxs)("div",{style:{textAlign:"center",width:120},children:[(0,o.jsx)("img",{src:e,alt:"img-".concat(t),style:{width:100,height:100,objectFit:"cover"}}),(0,o.jsx)("div",{children:(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",checked:!!j[e],onChange:()=>function(e){g(t=>(0,i.A)((0,i.A)({},t),{},{[e]:!t[e]}))}(e)})," Keep"]})}),(0,o.jsx)("div",{children:(0,o.jsx)("button",{type:"button",onClick:()=>{g(t=>(0,i.A)((0,i.A)({},t),{},{[e]:!1}))},children:"Remove"})})]},e)),0===x.length&&(0,o.jsx)("div",{children:"No existing images"})]}),(0,o.jsx)("h3",{style:{marginTop:16},children:"Add Images"}),(0,o.jsx)("input",{ref:s,type:"file",multiple:!0,onChange:function(e){const t=Array.from(e.target.files||[]);if(!t.length)return;const n=t.map(e=>({file:e,previewUrl:URL.createObjectURL(e)}));y(e=>[...e,...n]),s.current&&(s.current.value="")}}),(0,o.jsxs)("div",{style:{marginTop:8,display:"flex",gap:12,flexWrap:"wrap"},children:[f.map((e,t)=>(0,o.jsxs)("div",{style:{textAlign:"center",width:120},children:[(0,o.jsx)("img",{src:e.previewUrl,alt:"preview-".concat(t),style:{width:100,height:100,objectFit:"cover"}}),(0,o.jsx)("div",{children:(0,o.jsx)("button",{type:"button",onClick:()=>{return e=t,void y(t=>{const s=[...t],n=s.splice(e,1)[0];return n&&n.previewUrl&&URL.revokeObjectURL(n.previewUrl),s});var e},children:"Remove"})})]},e.previewUrl+t)),0===f.length&&(0,o.jsx)("div",{children:"No files chosen"})]})]})]})}const u="https://api.seemati.in/api";function h(){const[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!0),[i,l]=(0,n.useState)(!1),[d,a]=(0,n.useState)(null),[c,p]=(0,n.useState)("");return(0,n.useEffect)(()=>{let e=!0;return async function(){try{const s=await fetch("".concat(u,"/admin-api/settings/announcements"));if(!s.ok)throw new Error("Failed to fetch");const n=await s.json();if(!e)return;t(Array.isArray(n.messages)?n.messages:[])}catch(s){e&&a("Unable to load announcements")}finally{e&&r(!1)}}(),()=>{e=!1}},[]),s?(0,o.jsx)("div",{children:"Loading announcements\u2026"}):(0,o.jsxs)("div",{style:{padding:12},children:[(0,o.jsx)("h3",{children:"Announcements"}),d&&(0,o.jsx)("div",{style:{color:"red"},children:d}),(0,o.jsxs)("div",{style:{marginBottom:8},children:[(0,o.jsx)("input",{value:c,onChange:e=>p(e.target.value),style:{width:"70%",padding:8},placeholder:"New announcement"}),(0,o.jsx)("button",{onClick:function(){const e=(c||"").trim();e&&(t(t=>[...t,e]),p(""))},style:{marginLeft:8,padding:"8px 12px"},children:"Add"})]}),(0,o.jsxs)("div",{children:[0===e.length&&(0,o.jsx)("div",{children:"No announcements"}),(0,o.jsx)("ul",{style:{listStyle:"none",padding:0},children:e.map((s,n)=>(0,o.jsxs)("li",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[(0,o.jsx)("div",{style:{flex:1},children:s}),(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{onClick:()=>{var e;(e=n)<=0||t(t=>{const s=[...t],[n]=s.splice(e,1);return s.splice(e-1,0,n),s})},disabled:0===n,children:"\u2191"}),(0,o.jsx)("button",{onClick:()=>{return e=n,void t(t=>{if(e>=t.length-1)return t;const s=[...t],[n]=s.splice(e,1);return s.splice(e+1,0,n),s});var e},disabled:n===e.length-1,style:{marginLeft:6},children:"\u2193"}),(0,o.jsx)("button",{onClick:()=>{return e=n,void t(t=>t.filter((t,s)=>s!==e));var e},style:{marginLeft:6},children:"Remove"})]})]},n))})]}),(0,o.jsx)("div",{style:{marginTop:12},children:(0,o.jsx)("button",{onClick:async function(){l(!0),a(null);try{const t=await fetch("".concat(u,"/admin-api/settings/announcements"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e})});if(!t.ok){const e=await t.text();throw new Error(e||"Save failed")}alert("Announcements saved")}catch(t){console.error(t),a("Save failed")}finally{l(!1)}},disabled:i,style:{padding:"8px 14px"},children:i?"Saving\u2026":"Save announcements"})})]})}function x(){const e=(0,r.zy)();return(0,n.useEffect)(()=>(console.debug("[AdminPage] mounted, location:",e.pathname),()=>console.debug("[AdminPage] unmounted")),[e.pathname]),(0,o.jsx)("main",{style:{padding:18},children:(0,o.jsxs)("div",{style:{maxWidth:1200,margin:"0 auto"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:18},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{style:{margin:0},children:"Admin"}),(0,o.jsx)("div",{style:{fontSize:13,color:"#666"},children:"Manage products and site content"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(r.N_,{to:"/",style:{marginRight:12},children:"Back to site"}),(0,o.jsx)(r.N_,{to:"/admin/products",style:{marginRight:8},children:"Products"}),(0,o.jsx)(r.N_,{to:"/admin/announcements",children:"Announcements"})]})]}),(0,o.jsx)("div",{style:{background:"#fff",borderRadius:6,padding:8},children:(0,o.jsxs)(r.BV,{children:[(0,o.jsx)(r.qh,{path:"products",element:(0,o.jsx)(a,{})}),(0,o.jsx)(r.qh,{path:"products/add",element:(0,o.jsx)(p,{})}),(0,o.jsx)(r.qh,{path:"products/:id/edit",element:(0,o.jsx)(p,{})}),(0,o.jsx)(r.qh,{path:"announcements",element:(0,o.jsx)(h,{})}),(0,o.jsx)(r.qh,{path:"",element:(0,o.jsx)(a,{})})]})})]})})}},5026:(e,t,s)=>{s.d(t,{A:()=>r});const n=s(9722).A.create({baseURL:"https://api.seemati.in/api",withCredentials:!0,timeout:15e3,headers:{"Content-Type":"application/json",Accept:"application/json"}});n.interceptors.response.use(e=>e,e=>(e.response?console.error("API error:",e.response.status,e.response.data||e.response.statusText):console.error("Network error:",e.message),Promise.reject(e)));const r=n}}]);
//# sourceMappingURL=399.1179feef.chunk.js.map